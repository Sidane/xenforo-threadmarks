<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="sidaneThreadmarks" title="Threadmarks" version_string="1.0" version_id="1" url="" install_callback_class="Sidane_Threadmarks_Install" install_callback_method="install" uninstall_callback_class="Sidane_Threadmarks_Install" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="init_dependencies" execute_order="10" callback_class="Sidane_Threadmarks_Listener_InitDependencies" callback_method="initDependencies" active="1" hint="" description=""/>
    <listener event_id="load_class_controller" execute_order="5" callback_class="Sidane_Threadmarks_Listener_LoadClassController" callback_method="loadClassController" active="1" hint="" description=""/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="sidaneThreadmarks" display_order="30000" debug_only="0"/>
    <option option_id="threadmarksLimit" edit_format="spinbox" data_type="integer" can_backup="1">
      <default_value>8</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="sidaneThreadmarks" display_order="1"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="most_recent_threadmarks" version_id="1" version_string="1.0"><![CDATA[Most recent threadmarks]]></phrase>
    <phrase title="option_group_sidaneThreadmarks" version_id="1" version_string="1.0"><![CDATA[Threadmarks]]></phrase>
    <phrase title="option_group_sidaneThreadmarks_description" version_id="1" version_string="1.0"><![CDATA[]]></phrase>
    <phrase title="option_threadmarksLimit" version_id="1" version_string="1.0"><![CDATA[Max threadmarks in menu]]></phrase>
    <phrase title="option_threadmarksLimit_explain" version_id="1" version_string="1.0"><![CDATA[Limit the number of threadmarks to display in the drop down menu.]]></phrase>
    <phrase title="threadmark" version_id="1" version_string="1.0"><![CDATA[Threadmark]]></phrase>
    <phrase title="threadmarks" version_id="1" version_string="1.0"><![CDATA[Threadmarks]]></phrase>
    <phrase title="threadmarks_for" version_id="1" version_string="1.0"><![CDATA[Threadmarks for]]></phrase>
    <phrase title="view_all_threadmarks" version_id="1" version_string="1.0"><![CDATA[View all {count} threadmarks]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="threadmarks" version_id="1" version_string="1.0"><![CDATA[<xen:title>{xen:phrase threadmarks_for}: {xen:helper threadPrefix, $thread, escaped}{$thread.title}</xen:title>

<xen:h1>{xen:helper threadPrefix, $thread} {xen:phrase threadmarks_for}: {$thread.title}</xen:h1>

<xen:container var="$head.noindex">
  <meta name="robots" content="noindex" />
</xen:container>

<xen:navigation>
  <xen:breadcrumb source="$nodeBreadCrumbs" />
  <xen:breadcrumb href="{xen:link full:forums, $forum}">{$forum.title}</xen:breadcrumb>
  <xen:breadcrumb href="{xen:link full:threads, $thread}">{xen:helper threadPrefix, $thread}{$thread.title}</xen:breadcrumb>
</xen:navigation>

<div class="section">  
  <ol class="overlayScroll">
    <xen:foreach loop="$threadmarks" value="$threadmark">
      <li class="primaryContent memberListItem">
        <a href="{xen:link 'posts', $threadmark}">{$threadmark.label}</a>
        
        <div class="extra">
          <xen:datetime time="{$threadmark.post_date}" />
        </div>
      </li>
    </xen:foreach>
  </ol>
  
  <div class="sectionFooter overlayOnly"><a class="button primary OverlayCloser">{xen:phrase close}</a></div>
</div>]]></template>
    <template title="threadmarks.css" version_id="1" version_string="1.0"><![CDATA[.threadmarks .popupTrigger {
  width: auto;
  padding-left: 4px;
  padding-right: 4px;
}

.threadmarksMenu h4 {
  font-size: 14px;
  font-weight: bold;
  background-color: transparent;
  
}

.threadmarker {
  display: inline-block;
  margin: 0 0 0 3px;
  padding: 2px 8px 2px 6px;
  font-style: italics;
  color: #fff;
  background-color: #000;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}

.threadmarker strong {
  color: #fff000;
  font-weight: normal;
}

<xen:if is="{xen:property enableResponsive}">
@media (max-width:{xen:property maxResponsiveMediumWidth})
{
  .threadmarks .popupTrigger {
    clear: left;
    margin-top: 7px;
  }
}
</xen:if>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="page_nav" modification_key="sidaneThreadmarksModification" description="Add threadmarks HTML after thread pagination links" execution_order="100" enabled="1" action="str_replace">
      <find><![CDATA[</nav>]]></find>
      <replace><![CDATA[<xen:if is="{$linkData.has_threadmarks}">
  <xen:require css="threadmarks.css"/>
  <div class="Popup threadmarks">
    <a rel="Menu" class="popupTrigger">{xen:phrase threadmarks}</a>
    <div class="Menu threadmarksMenu">
      <xen:if is="{$linkData.more_threadmarks}">
        <div class="primaryContent menuHeader">
          <h4>{xen:phrase most_recent_threadmarks}:</h4>
        </div>
      </xen:if>

      <ul class="secondaryContent blockLinksList">
        <xen:foreach loop="{$linkData.threadmarks}" value="{$threadmark}">
          <li><a href="{xen:link full:posts, $threadmark}">{$threadmark.label}</a></li>
        </xen:foreach>
      </ul>

      <xen:if is="{$linkData.more_threadmarks}">
        <div class="primaryContent menuHeader">
          <a href="{xen:link 'threads/threadmarks', $linkData}" rel="nofollow" class="OverlayTrigger">{xen:phrase view_all_threadmarks, 'count={$linkData.total_threadmarks}'}</a>
        </div>
      </xen:if>
    </div>
  </div>
</xen:if>
$0]]></replace>
    </modification>
    <modification template="message" modification_key="sidaneThreadmarksModification1" description="Add flag before threadmarked post" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<li id="{$messageId}"]]></find>
      <replace><![CDATA[<xen:if is="{$thread.has_threadmarks}">
  {xen:helper render_threadmark_flag, $post.post_id, $thread.threadmarks}
</xen:if>
$0]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
