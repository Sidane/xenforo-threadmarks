<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="sidaneThreadmarks" title="Threadmarks" version_string="1.0" version_id="2" url="" install_callback_class="Sidane_Threadmarks_Install" install_callback_method="install" uninstall_callback_class="Sidane_Threadmarks_Install" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="load_class" execute_order="5" callback_class="Sidane_Threadmarks_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Thread" description=""/>
    <listener event_id="load_class" execute_order="5" callback_class="Sidane_Threadmarks_Listener" callback_method="load_class" active="1" hint="XenForo_ControllerPublic_Post" description=""/>
    <listener event_id="load_class" execute_order="10" callback_class="Sidane_Threadmarks_Listener" callback_method="load_class" active="1" hint="XenForo_DataWriter_DiscussionMessage_Post" description=""/>
    <listener event_id="load_class" execute_order="100" callback_class="Sidane_Threadmarks_Listener" callback_method="load_class" active="1" hint="XenForo_Model_Post" description=""/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="sidaneThreadmarks" display_order="30000" debug_only="0"/>
    <option option_id="sidaneThreadmarksHideMenuFromGuests" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>0</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="sidaneThreadmarks" display_order="1"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions>
      <permission permission_group_id="forum" permission_id="sidane_tm_add" permission_type="flag" default_value="unset" interface_group_id="forumPermissions" display_order="1230"/>
      <permission permission_group_id="forum" permission_id="sidane_tm_delete" permission_type="flag" default_value="unset" interface_group_id="forumPermissions" display_order="1250"/>
      <permission permission_group_id="forum" permission_id="sidane_tm_edit" permission_type="flag" default_value="unset" interface_group_id="forumPermissions" display_order="1240"/>
      <permission permission_group_id="forum" permission_id="sidane_tm_manage" permission_type="flag" default_value="unset" interface_group_id="forumModeratorPermissions" display_order="50000"/>
      <permission permission_group_id="forum" permission_id="sidane_tm_menu_limit" permission_type="integer" default_value_int="0" interface_group_id="forumPermissions" display_order="1220"/>
      <permission permission_group_id="forum" permission_id="sidane_tm_view" permission_type="flag" default_value="unset" interface_group_id="forumPermissions" display_order="1210"/>
    </permissions>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="add_threadmark" version_id="1" version_string="1.0"><![CDATA[Add Threadmark]]></phrase>
    <phrase title="delete_threadmark" version_id="1" version_string="1.0"><![CDATA[Delete this threadmark]]></phrase>
    <phrase title="edit_threadmark" version_id="1" version_string="1.0"><![CDATA[Edit Threadmark]]></phrase>
    <phrase title="most_recent_threadmarks" version_id="1" version_string="1.0"><![CDATA[Most recent threadmarks]]></phrase>
    <phrase title="option_group_sidaneThreadmarks" version_id="1" version_string="1.0"><![CDATA[Threadmarks]]></phrase>
    <phrase title="option_group_sidaneThreadmarks_description" version_id="1" version_string="1.0"><![CDATA[]]></phrase>
    <phrase title="option_sidaneThreadmarksHideMenuFromGuests" version_id="1" version_string="1.0"><![CDATA[Hide threadmarks drop down menu from guests]]></phrase>
    <phrase title="option_sidaneThreadmarksHideMenuFromGuests_explain" version_id="1" version_string="1.0"><![CDATA[If enabled, guests will have to click the threadmarks link to see the list of threadmarks.]]></phrase>
    <phrase title="permission_forum_sidane_tm_add" version_id="2" version_string="1.0"><![CDATA[Add Threadmarks to Own Thread]]></phrase>
    <phrase title="permission_forum_sidane_tm_delete" version_id="2" version_string="1.0"><![CDATA[Delete Threadmarks in Own Thread]]></phrase>
    <phrase title="permission_forum_sidane_tm_edit" version_id="2" version_string="1.0"><![CDATA[Edit Threadmarks in Own Thread]]></phrase>
    <phrase title="permission_forum_sidane_tm_manage" version_id="2" version_string="1.0"><![CDATA[Manage threadmarks]]></phrase>
    <phrase title="permission_forum_sidane_tm_menu_limit" version_id="2" version_string="1.0"><![CDATA[Max Threadmarks In Menu]]></phrase>
    <phrase title="permission_forum_sidane_tm_view" version_id="2" version_string="1.0"><![CDATA[View Threadmarks]]></phrase>
    <phrase title="please_enter_label_for_threadmark" version_id="1" version_string="1.0"><![CDATA[Please enter label for Threadmark]]></phrase>
    <phrase title="sidane_threadmarks_cache" version_id="2" version_string="2.0"><![CDATA[Threadmark cache]]></phrase>
    <phrase title="threadmark" global_cache="1" version_id="1" version_string="1.0"><![CDATA[Threadmark]]></phrase>
    <phrase title="threadmarks" version_id="1" version_string="1.0"><![CDATA[Threadmarks]]></phrase>
    <phrase title="threadmarks_for" version_id="1" version_string="1.0"><![CDATA[Threadmarks for]]></phrase>
    <phrase title="threadmark_created" version_id="1" version_string="1.0"><![CDATA[Threadmark created]]></phrase>
    <phrase title="threadmark_deleted" version_id="1" version_string="1.0"><![CDATA[Threadmark deleted]]></phrase>
    <phrase title="threadmark_label" version_id="1" version_string="1.0"><![CDATA[Threadmark label]]></phrase>
    <phrase title="threadmark_updated" version_id="1" version_string="1.0"><![CDATA[Threadmark updated]]></phrase>
    <phrase title="update_threadmark" version_id="1" version_string="1.0"><![CDATA[Update Threadmark]]></phrase>
    <phrase title="view_all_threadmarks" version_id="1" version_string="1.0"><![CDATA[View all {count} threadmarks]]></phrase>
    <phrase title="you_do_not_have_permission_to_add_threadmarks" version_id="2" version_string="1.0"><![CDATA[You do not have permission to add threadmarks.]]></phrase>
    <phrase title="you_do_not_have_permission_to_delete_threadmarks" version_id="2" version_string="1.0"><![CDATA[You do not have permission to delete threadmarks.]]></phrase>
    <phrase title="you_do_not_have_permission_to_edit_threadmarks" version_id="2" version_string="1.0"><![CDATA[You do not have permission to edit threadmarks.]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="edit_threadmark" version_id="2" version_string="1.0"><![CDATA[<xen:title>{xen:helper threadPrefix, $thread, escaped}{$thread.title} - {xen:phrase edit_threadmark}</xen:title>
<xen:h1>{xen:phrase edit_threadmark}</xen:h1>

<xen:navigation>
	<xen:breadcrumb source="$nodeBreadCrumbs" />
	<xen:breadcrumb href="{xen:link full:posts, $post}">{xen:helper threadPrefix, $thread}{$thread.title}</xen:breadcrumb>
</xen:navigation>

<xen:container var="$bodyClasses">{xen:helper nodeClasses, $nodeBreadCrumbs, $forum}</xen:container>
<xen:container var="$searchBar.thread"><xen:include template="search_bar_thread_only" /></xen:container>
<xen:container var="$searchBar.forum"><xen:include template="search_bar_forum_only" /></xen:container>

<form action="{xen:link 'posts/threadmark', $post}" method="post" class="xenForm formOverlay AutoValidator" data-redirect="on">

	<dl class="ctrlUnit">
		<dt><label for="ctrl_message">{xen:phrase threadmark_label}:</label></dt>
		<dd><input type="text" name="label" id="ctrl_message" class="textCtrl" value="{$threadmark.label}" maxlength="100" <xen:if is="!{$post.canEditThreadmarks}">readonly</xen:if> /></dd>

        <xen:if is="{$post.canDeleteThreadmarks}">
        <dt>&nbsp;</dt>
        <dd><label><input type="checkbox" name="_xfConfirm" value="1" /> {xen:phrase delete_threadmark}</label></dd>
        </xen:if>
	</dl>

	<dl class="ctrlUnit submitUnit">
		<dt></dt>
		<dd><input type="submit" value="{xen:phrase update_threadmark}" accesskey="s" class="button primary" /></dd>
	</dl>

	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
</form>]]></template>
    <template title="new_threadmark" version_id="1" version_string="1.0"><![CDATA[<xen:title>{xen:helper threadPrefix, $thread, escaped}{$thread.title} - {xen:phrase add_threadmark}</xen:title>
<xen:h1>{xen:phrase add_threadmark}</xen:h1>

<xen:navigation>
	<xen:breadcrumb source="$nodeBreadCrumbs" />
	<xen:breadcrumb href="{xen:link full:posts, $post}">{xen:helper threadPrefix, $thread}{$thread.title}</xen:breadcrumb>
</xen:navigation>

<xen:container var="$bodyClasses">{xen:helper nodeClasses, $nodeBreadCrumbs, $forum}</xen:container>
<xen:container var="$searchBar.thread"><xen:include template="search_bar_thread_only" /></xen:container>
<xen:container var="$searchBar.forum"><xen:include template="search_bar_forum_only" /></xen:container>

<form action="{xen:link 'posts/threadmark', $post}" method="post" class="xenForm formOverlay AutoValidator" data-redirect="on">

	<dl class="ctrlUnit">
		<dt><label for="ctrl_message">{xen:phrase threadmark_label}:</label></dt>
		<dd><input type="text" name="label" id="ctrl_message" class="textCtrl" maxlength="100" /></dd>
	</dl>

	<dl class="ctrlUnit submitUnit">
		<dt></dt>
		<dd><input type="submit" value="{xen:phrase add_threadmark}" accesskey="s" class="button primary" /></dd>
	</dl>

	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
</form>]]></template>
    <template title="new_threadmark_control" version_id="2" version_string="1.0"><![CDATA[<xen:if is="{$post.canAddThreadmarks} OR {$post.canEditThreadmarks} OR {$post.canDeleteThreadmarks}">
  <a href="{xen:link posts/threadmark, $post}" class="OverlayTrigger item control threadmark" data-cacheOverlay="false"><span></span>{xen:phrase threadmark}</a>
</xen:if>]]></template>
    <template title="page_nav_threadmarks" version_id="2" version_string="1.0"><![CDATA[<xen:if is="{$threadmarks}">
  <xen:if is="{$threadmarks.logged_in} OR {$threadmarks.hide_menu_from_guests} != '1'">
    <div class="Popup threadmarks">
      <a rel="Menu" class="threadmarksTrigger">{xen:phrase threadmarks}</a>
      <div class="Menu threadmarksMenu">
        <xen:if is="{$threadmarks.more_threadmarks}">
          <div class="primaryContent menuHeader">
            <h4>{xen:phrase most_recent_threadmarks}:</h4>
          </div>
        </xen:if>

        <ul class="secondaryContent blockLinksList">
          <xen:foreach loop="{$threadmarks.recent}" value="{$threadmark}">
            <li><a href="{xen:link full:posts, $threadmark}">{$threadmark.label}</a></li>
          </xen:foreach>
        </ul>

        <xen:if is="{$threadmarks.more_threadmarks}">
          <div class="primaryContent menuHeader">
            <a href="{xen:link 'threads/threadmarks', $linkData}" rel="nofollow" class="OverlayTrigger">{xen:phrase view_all_threadmarks, 'count={$threadmarks.count}'}</a>
          </div>
        </xen:if>
      </div>
    </div>
  <xen:else/>
    <a href="{xen:link 'threads/threadmarks', $linkData}" rel="nofollow" class="OverlayTrigger threadmarksTrigger">{xen:phrase threadmarks}</a>
  </xen:if>
</xen:if>]]></template>
    <template title="single_page_thread_threadmarks_menu" version_id="2" version_string="1.0"><![CDATA[<xen:if is="{$singlePageThread}">
  <div class="PageNav threadmarksSinglePage">
    <xen:include template="page_nav_threadmarks">
      <xen:map from="$thread.threadmarks" to="$threadmarks"/>
    </xen:include>
  </div>
</xen:if>]]></template>
    <template title="threadmarks" version_id="1" version_string="1.0"><![CDATA[<xen:title>{xen:phrase threadmarks_for}: {xen:helper threadPrefix, $thread, escaped}{$thread.title}</xen:title>

<xen:h1>{xen:helper threadPrefix, $thread} {xen:phrase threadmarks_for}: {$thread.title}</xen:h1>

<xen:container var="$head.noindex">
  <meta name="robots" content="noindex" />
</xen:container>

<xen:navigation>
  <xen:breadcrumb source="$nodeBreadCrumbs" />
  <xen:breadcrumb href="{xen:link full:forums, $forum}">{$forum.title}</xen:breadcrumb>
  <xen:breadcrumb href="{xen:link full:threads, $thread}">{xen:helper threadPrefix, $thread}{$thread.title}</xen:breadcrumb>
</xen:navigation>

<div class="section">
  <ol class="overlayScroll">
    <xen:foreach loop="$threadmarks" value="$threadmark">
      <li class="primaryContent memberListItem">
        <a href="{xen:link 'posts', $threadmark}">{$threadmark.label}</a>

        <div class="extra">
          <xen:datetime time="{$threadmark.post_date}" />
        </div>
      </li>
    </xen:foreach>
  </ol>

  <div class="sectionFooter overlayOnly"><a class="button primary OverlayCloser">{xen:phrase close}</a></div>
</div>]]></template>
    <template title="threadmarks.css" version_id="2" version_string="1.0"><![CDATA[.PageNav.threadmarksSinglePage {
  float: left;
  min-width: 0;
}

.PageNav a.threadmarksTrigger {
  width: auto !important;
  padding-left: 4px;
  padding-right: 4px;
}

.threadmarksMenu h4 {
  font-size: 14px;
  font-weight: bold;
  background-color: transparent;
}

.threadmarker {
  display: inline-block;
  margin: 0;
  padding: 3px 8px 2px 6px;
  font-style: italics;
  color: {xen:property contentText};
  background-color: {xen:property primaryLighterStill};
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}

.threadmarker strong {
  color: {xen:property secondaryMedium};
  font-weight: bold;
}

<xen:if is="{xen:property enableResponsive}">
@media (max-width:{xen:property maxResponsiveMediumWidth})
{
  .PageNav a.threadmarksTrigger {
    clear: left;
    margin-top: 7px;
  }
}
</xen:if>]]></template>
    <template title="threadmarks_render_flag" version_id="2" version_string="1.0"><![CDATA[<xen:if is="{$threadmark} and {$post.canViewThreadmarks}">
  <span class='threadmarker' id='post-{$post.post_id}'><strong>{xen:phrase threadmark}:</strong> {$threadmark.label}</span>
</xen:if>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="post" modification_key="sidaneThreadmarkPostControl" description="Add 'Threadmarks' link to post controls" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:if is="{$post.canReport}">]]></find>
      <replace><![CDATA[<xen:include template="new_threadmark_control"/>
$0]]></replace>
    </modification>
    <modification template="thread_view" modification_key="sidaneThreadmarksCss" description="Add threadmarks CSS to threads with threadmarks" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:container var="$head.canonical">]]></find>
      <replace><![CDATA[<xen:if is="{$thread.threadmark_count} > 0">
  <xen:require css="threadmarks.css"/>
</xen:if>
$0]]></replace>
    </modification>
    <modification template="thread_view" modification_key="sidaneThreadmarksMenuOnSinglePageThreads" description="Display threadmarks menu on single page threads" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:pagenav]]></find>
      <replace><![CDATA[<xen:include template="single_page_thread_threadmarks_menu"/>

$0]]></replace>
    </modification>
    <modification template="page_nav" modification_key="sidaneThreadmarksModification" description="Display threadmarks menu on multi-page threads" execution_order="100" enabled="1" action="str_replace">
      <find><![CDATA[</nav>]]></find>
      <replace><![CDATA[<xen:include template="page_nav_threadmarks">
  <xen:map from="$linkData.threadmarks" to="$threadmarks" />
</xen:include>
$0]]></replace>
    </modification>
    <modification template="message" modification_key="sidaneThreadmarksModification1" description="Add flag before threadmarked post" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<li id="{$messageId}"]]></find>
      <replace><![CDATA[<xen:include template="threadmarks_render_flag">
  <xen:map from="$thread.threadmarks.all.{$post.post_id}" to="$threadmark" />
</xen:include>
$0]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
