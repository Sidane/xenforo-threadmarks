!function(a,b,c,d){a.tools.tooltip.addEffect("RightPreviewTooltip",function(c){var d=this.getTrigger().offset(),e=this.getConf(),f={top:"auto",bottom:a(b).height()-d.top+e.offset[0]},g=a(b).width()<480;g?f.left=Math.min(50,d.left+e.offset[1]):(f.right=a("html").width()-this.getTrigger().outerWidth()-d.left-e.offset[1],f.left="auto");var h=this.getTip();h.css(f);var i=a(b).scrollTop()-d.top+e.offset[0]+h.outerHeight();if(i>=0&&h.css({top:d.top+e.offset[0]+this.getTrigger().outerHeight(),bottom:"auto"}),!g){var j=h.find(".arrow");i>=0?j.hide():j.css({left:h.width()-e.offset[1]-j.outerWidth(),top:"auto"})}h.xfFadeIn(XenForo.speed.normal)},function(a){this.getTip().xfFadeOut(XenForo.speed.fast)}),XenForo.RightPreviewTooltip=function(b){var d,e,f;if(parseInt(XenForo._enableOverlays)){if(!(e=b.data("previewurl")))return void console.warn("Preview tooltip has no preview: %o",b);b.find("[title]").andSelf().attr("title",""),b.bind({mouseenter:function(g){d||(f=setTimeout(function(){if(!d){d=!0;var g,h,f=a("#PreviewTooltip");if(!f.length)return void console.error("Unable to find #PreviewTooltip");console.log("Setup preview tooltip for %s",e),g=f.clone().removeAttr("id").addClass("xenPreviewTooltip").appendTo(c.body),XenForo._PreviewTooltipCache[e]||(h=XenForo.ajax(e,{},function(b){XenForo.hasTemplateHtml(b)?(XenForo._PreviewTooltipCache[e]=b.templateHtml,a(b.templateHtml).xfInsert("replaceAll",g.find(".PreviewContents"))):g.remove()},{type:"GET",error:!1,global:!1})),b.tooltip(XenForo.configureTooltipRtl({predelay:500,delay:0,effect:"RightPreviewTooltip",fadeInSpeed:"normal",fadeOutSpeed:"fast",tip:g,position:"bottom right",offset:[10,15]})),b.data("tooltip").show(0),XenForo._PreviewTooltipCache[e]&&a(XenForo._PreviewTooltipCache[e]).xfInsert("replaceAll",g.find(".PreviewContents"),"show",0)}},800))},mouseleave:function(a){return d?void(b.data("tooltip")&&b.data("tooltip").hide()):void(f&&clearTimeout(f))},mousedown:function(a){f&&clearTimeout(f),b.data("tooltip")&&b.data("tooltip").hide()}})}},XenForo.ThreadmarkSortable=function(b){function c(a){for(var b in a){var d=a[b];"li_attr"==b||"a_attr"==b||"icon"==b||"data"==b||"text"==b?delete a[b]:"object"==typeof d&&c(d)}}var d=b.data("sort-url");return d?(a(".fa-lock").show(),a(".fa-unlock").click(function(){location.reload(!0)}),void a(".fa-lock").click(function(){a(".fa-lock").hide(),b.find(".PreviewTooltip").removeClass("PreviewTooltip"),b.jstree({core:{check_callback:!0,themes:{icons:!1},animation:0},dnd:{copy:!1,large_drop_target:!0,large_drag_target:!0,drag_selection:!0,inside_pos:"last"},plugins:["dnd","wholerow"]}).on("move_node.jstree",function(a,e){e.node.parent&&b.jstree("open_node",e.node.parent);var f=b.data().jstree.get_json(null,{no_state:!0,no_data:!0});return f?(c(f),b.data("sort-timer")&&clearTimeout(b.data("sort-timer")),void b.data("sort-timer",setTimeout(function(){XenForo.ajax(d,{order:f},function(a){console.info("threadmarks updated")})},100))):void console.info("no threadmark data to serialize")}),a(".fa-unlock").show()})):void console.log("No data-sort-url for sortable.")},XenForo.ThreadmarkQuickReply=function(b){b.on("QuickReplyComplete",function(){a("#ctrl_threadmark").val("")})},XenForo.isTouchBrowser()||XenForo.register(".RightPreviewTooltip","XenForo.RightPreviewTooltip"),XenForo.register(".ThreadmarkSortable","XenForo.ThreadmarkSortable"),XenForo.register("#QuickReply","XenForo.ThreadmarkQuickReply")}(jQuery,this,document);