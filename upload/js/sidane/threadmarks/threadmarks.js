var Sidane=Sidane||{};!function(a,b,c,d){a.tools.tooltip.addEffect("RightPreviewTooltip",function(){var c=this.getTrigger().offset(),d=this.getConf(),e={top:"auto",bottom:a(b).height()-c.top+d.offset[0]},f=a(b).width()<480;f?e.left=Math.min(50,c.left+d.offset[1]):(e.right=a("html").width()-this.getTrigger().outerWidth()-c.left-d.offset[1],e.left="auto");var g=this.getTip();g.css(e);var h=a(b).scrollTop()-c.top+d.offset[0]+g.outerHeight();if(h>=0&&g.css({top:c.top+d.offset[0]+this.getTrigger().outerHeight(),bottom:"auto"}),!f){var i=g.find(".arrow");h>=0?i.hide():i.css({left:g.width()-d.offset[1]-i.outerWidth(),top:"auto"})}g.xfFadeIn(XenForo.speed.normal)},function(){this.getTip().xfFadeOut(XenForo.speed.fast)}),XenForo.RightPreviewTooltip=function(b){var d,e,f;if(parseInt(XenForo._enableOverlays)){if(!(e=b.data("previewurl")))return void console.warn("Preview tooltip has no preview: %o",b);b.find("[title]").andSelf().attr("title",""),b.bind({mouseenter:function(){d||(f=setTimeout(function(){if(!d){d=!0;var g,f=a("#PreviewTooltip");if(!f.length)return void console.error("Unable to find #PreviewTooltip");console.log("Setup preview tooltip for %s",e),g=f.clone().removeAttr("id").addClass("xenPreviewTooltip").appendTo(c.body),XenForo._PreviewTooltipCache[e]||XenForo.ajax(e,{},function(b){XenForo.hasTemplateHtml(b)?(XenForo._PreviewTooltipCache[e]=b.templateHtml,a(b.templateHtml).xfInsert("replaceAll",g.find(".PreviewContents"))):g.remove()},{type:"GET",error:!1,global:!1}),b.tooltip(XenForo.configureTooltipRtl({predelay:500,delay:0,effect:"RightPreviewTooltip",fadeInSpeed:"normal",fadeOutSpeed:"fast",tip:g,position:"bottom right",offset:[10,15]})),b.data("tooltip").show(0),XenForo._PreviewTooltipCache[e]&&a(XenForo._PreviewTooltipCache[e]).xfInsert("replaceAll",g.find(".PreviewContents"),"show",0)}},800))},mouseleave:function(){if(d)return void(b.data("tooltip")&&b.data("tooltip").hide());f&&clearTimeout(f)},mousedown:function(){f&&clearTimeout(f),b.data("tooltip")&&b.data("tooltip").hide()}})}},Sidane.ThreadmarkSortTree=function(a){this.__construct(a)},Sidane.ThreadmarkSortTree.prototype={__construct:function(b){this.$tree=b,this.$threadmarkList=b.parent().find(b.data("threadmark-list")),this.buttons={$edit:b.parent().find(".EditSortTree"),$save:b.parent().find(".SaveSortTree")},this.urls={load:b.data("load-url"),sync:b.data("sync-url"),index:b.data("index-url")},this.buttons.$edit.on("click",a.context(this,"eEditButtonClick")),this.buttons.$save.on("click",a.context(this,"eSaveButtonClick")),this.init()},init:function(){this.buttons.$save.hide()},load:function(){XenForo.ajax(this.urls.load,"",a.context(function(a){this.$threadmarkList.remove(),this.$tree.jstree({plugins:["dnd","wholerow"],core:{data:a.tree,check_callback:!0,themes:{icons:!1,dots:!1},animation:0},dnd:{copy:!1,drag_selection:!0,large_drag_target:!0,large_drop_target:!0,touch:"selected",inside_pos:"last"}})},this))},sync:function(){var c={tree:JSON.stringify(this.$tree.jstree(!0).get_json("#",{flat:!0}))};XenForo.ajax(this.urls.sync,c,a.context(function(){if(console.log("Tree synchronized"),this.$tree.closest(".xenOverlay").length>0){new XenForo.OverlayLoader(a({href:this.urls.index}),!1,{speed:XenForo.speed.fast}).load()}else b.location=this.urls.index},this))},eEditButtonClick:function(a){a.preventDefault(),this.buttons.$edit.hide(),this.buttons.$save.show(),this.load()},eSaveButtonClick:function(a){a.preventDefault(),this.sync()}},Sidane.ThreadmarkPositionFiller=function(a){this.__construct(a)},Sidane.ThreadmarkPositionFiller.prototype={__construct:function(b){this.$form=b,this.positionFillerUrl=b.data("position-filler-url"),this.phrases={threadmark_insert_before_existing:b.data("threadmark-insert-before-existing-phrase"),threadmark_after_this_post:b.data("threadmark-after-this-post-phrase"),threadmark_end_of_index:b.data("threadmark-end-of-index-phrase")},this.$threadmarkCategoryIdInput=b.find(':input[name="threadmark_category_id"]'),this.$positionContainer=b.find(".PositionContainer"),this.threadmarkCategoryId=0,this.previousThreadmark=!1,this.lastThreadmark=!1,this.init(),this.$threadmarkCategoryIdInput.on("change",a.context(this,"eThreadmarkCategoryIdChange"))},init:function(){this.update()},update:function(){this.threadmarkCategoryId=this.$threadmarkCategoryIdInput.val(),XenForo.ajax(this.positionFillerUrl,{category_id:this.threadmarkCategoryId},a.context(function(a){this.previousThreadmark=a.previousThreadmark,this.lastThreadmark=a.lastThreadmark,!this.previousThreadmark&&this.lastThreadmark&&(this.previousThreadmark={position:0,label:this.phrases.threadmark_insert_before_existing,link:!1}),this.updatePositionInputs()},this))},updatePositionInputs:function(){this.updatePositionInput(this.$positionContainer.find(".PreviousThreadmark"),this.previousThreadmark,this.phrases.threadmark_after_this_post),this.updatePositionInput(this.$positionContainer.find(".LastThreadmark"),this.lastThreadmark,this.phrases.threadmark_end_of_index),this.updatePositionInputVisibility()},updatePositionInput:function(b,c,d){c||(c={position:0,label:"",link:!1}),b.find(":input").val(c.position+1);var f=b.find(".text");if(f.text(c.label),c.link){var g=a("<a></a>");g.attr("href",c.link),g.attr("title",d),g.attr("target","_blank"),f.wrapInner(g)}},updatePositionInputVisibility:function(){this.$positionContainer.show(),this.$positionContainer.find(".PreviousThreadmark").show(),this.$positionContainer.find(':input[name="position"]').attr("checked",!1),this.previousThreadmark||this.lastThreadmark?this.previousThreadmark.position===this.lastThreadmark.position&&this.$positionContainer.find(".PreviousThreadmark").hide():this.$positionContainer.hide(),this.$positionContainer.find(':input[name="position"]:visible:first').attr("checked",!0)},eThreadmarkCategoryIdChange:function(){this.update()}},Sidane.ThreadmarkIndex=function(a){if(a.closest(".xenOverlay").length>0){var b=a.find(".tabs li:not(.sortTreeButton) a");b.addClass("OverlayTrigger"),b.data("cacheoverlay",!0),a.xfActivate()}},Sidane.ThreadmarkQuickReply=function(b){b.on("QuickReplyComplete",function(){a("#ctrl_threadmark").val(""),a("#ctrl_threadmark_category_id").val("0")})},XenForo.register(".ThreadmarkSortTree","Sidane.ThreadmarkSortTree"),XenForo.register(".ThreadmarkPositionFiller","Sidane.ThreadmarkPositionFiller"),XenForo.register(".ThreadmarkIndex","Sidane.ThreadmarkIndex"),XenForo.register("#QuickReply","Sidane.ThreadmarkQuickReply"),XenForo.isTouchBrowser()||XenForo.register(".RightPreviewTooltip","XenForo.RightPreviewTooltip")}(jQuery,this,document);