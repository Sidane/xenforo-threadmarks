var Sidane=Sidane||{};!function(a,b,c,d){a.tools.tooltip.addEffect("RightPreviewTooltip",function(){var c=this.getTrigger().offset(),d=this.getConf(),e={top:"auto",bottom:a(b).height()-c.top+d.offset[0]},f=a(b).width()<480;f?e.left=Math.min(50,c.left+d.offset[1]):(e.right=a("html").width()-this.getTrigger().outerWidth()-c.left-d.offset[1],e.left="auto");var g=this.getTip();g.css(e);var h=a(b).scrollTop()-c.top+d.offset[0]+g.outerHeight();if(h>=0&&g.css({top:c.top+d.offset[0]+this.getTrigger().outerHeight(),bottom:"auto"}),!f){var i=g.find(".arrow");h>=0?i.hide():i.css({left:g.width()-d.offset[1]-i.outerWidth(),top:"auto"})}g.xfFadeIn(XenForo.speed.normal)},function(){this.getTip().xfFadeOut(XenForo.speed.fast)}),XenForo.RightPreviewTooltip=function(b){var d,e,f;if(parseInt(XenForo._enableOverlays)){if(!(e=b.data("previewurl")))return void console.warn("Preview tooltip has no preview: %o",b);b.find("[title]").andSelf().attr("title",""),b.bind({mouseenter:function(){d||(f=setTimeout(function(){if(!d){d=!0;var g,f=a("#PreviewTooltip");if(!f.length)return void console.error("Unable to find #PreviewTooltip");console.log("Setup preview tooltip for %s",e),g=f.clone().removeAttr("id").addClass("xenPreviewTooltip").appendTo(c.body),XenForo._PreviewTooltipCache[e]||XenForo.ajax(e,{},function(b){XenForo.hasTemplateHtml(b)?(XenForo._PreviewTooltipCache[e]=b.templateHtml,a(b.templateHtml).xfInsert("replaceAll",g.find(".PreviewContents"))):g.remove()},{type:"GET",error:!1,global:!1}),b.tooltip(XenForo.configureTooltipRtl({predelay:500,delay:0,effect:"RightPreviewTooltip",fadeInSpeed:"normal",fadeOutSpeed:"fast",tip:g,position:"bottom right",offset:[10,15]})),b.data("tooltip").show(0),XenForo._PreviewTooltipCache[e]&&a(XenForo._PreviewTooltipCache[e]).xfInsert("replaceAll",g.find(".PreviewContents"),"show",0)}},800))},mouseleave:function(){if(d)return void(b.data("tooltip")&&b.data("tooltip").hide());f&&clearTimeout(f)},mousedown:function(){f&&clearTimeout(f),b.data("tooltip")&&b.data("tooltip").hide()}})}},Sidane.ThreadmarkSortTree=function(a){this.__construct(a)},Sidane.ThreadmarkSortTree.prototype={__construct:function(b){this.$tree=b,this.$threadmarkList=b.parent().find(b.data("threadmarklist")),this.buttons={$edit:b.parent().find(b.data("editbutton")),$save:b.parent().find(b.data("savebutton"))},this.urls={load:b.data("loadurl"),sync:b.data("syncurl"),index:b.data("indexurl")},this.buttons.$edit.on("click",a.context(this,"eEditButtonClick")),this.buttons.$save.on("click",a.context(this,"eSaveButtonClick")),this.init()},init:function(){this.buttons.$save.hide()},load:function(){XenForo.ajax(this.urls.load,"",a.context(function(a){this.$threadmarkList.remove(),this.$tree.jstree({plugins:["dnd","wholerow"],core:{data:a.tree,check_callback:!0,themes:{icons:!1,dots:!1},animation:0},dnd:{copy:!1,drag_selection:!0,large_drag_target:!0,large_drop_target:!0,touch:"selected",inside_pos:"last"}})},this))},sync:function(){var b={tree:this.$tree.jstree(!0).get_json("#",{flat:!0})};XenForo.ajax(this.urls.sync,b,a.context(function(){console.log("Tree synchronized"),new XenForo.OverlayLoader(a({href:this.urls.index}),!1,{speed:XenForo.speed.fast}).load()},this))},eEditButtonClick:function(a){a.preventDefault(),this.buttons.$edit.hide(),this.buttons.$save.show(),this.load()},eSaveButtonClick:function(a){a.preventDefault(),this.sync()}},Sidane.ThreadmarkQuickReply=function(b){b.on("QuickReplyComplete",function(){a("#ctrl_threadmark").val(""),a("#ctrl_threadmark_category_id").val("0")})},XenForo.register(".ThreadmarkSortTree","Sidane.ThreadmarkSortTree"),XenForo.register("#QuickReply","Sidane.ThreadmarkQuickReply"),XenForo.isTouchBrowser()||XenForo.register(".RightPreviewTooltip","XenForo.RightPreviewTooltip")}(jQuery,this,document);
