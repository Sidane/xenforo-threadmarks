var Sidane=Sidane||{};!function(t,e,i,o){t.tools.tooltip.addEffect("RightPreviewTooltip",function(){var i=this.getTrigger().offset(),o=this.getConf(),r={top:"auto",bottom:t(e).height()-i.top+o.offset[0]},a=t(e).width()<480;a?r.left=Math.min(50,i.left+o.offset[1]):(r.right=t("html").width()-this.getTrigger().outerWidth()-i.left-o.offset[1],r.left="auto");var n=this.getTip();n.css(r);var s=t(e).scrollTop()-i.top+o.offset[0]+n.outerHeight();if(s>=0&&n.css({top:i.top+o.offset[0]+this.getTrigger().outerHeight(),bottom:"auto"}),!a){var d=n.find(".arrow");s>=0?d.hide():d.css({left:n.width()-o.offset[1]-d.outerWidth(),top:"auto"})}n.xfFadeIn(XenForo.speed.normal)},function(){this.getTip().xfFadeOut(XenForo.speed.fast)}),Sidane.RightPreviewTooltip=function(e){var o,r,a;parseInt(XenForo._enableOverlays)&&((r=e.data("previewurl"))?(e.find("[title]").andSelf().attr("title",""),e.bind({mouseenter:function(){o||(a=setTimeout(function(){if(!o){o=!0;var a,n=t("#PreviewTooltip");n.length?(console.log("Setup preview tooltip for %s",r),a=n.clone().removeAttr("id").addClass("xenPreviewTooltip").appendTo(i.body),XenForo._PreviewTooltipCache[r]||XenForo.ajax(r,{},function(e){XenForo.hasTemplateHtml(e)?(XenForo._PreviewTooltipCache[r]=e.templateHtml,t(e.templateHtml).xfInsert("replaceAll",a.find(".PreviewContents"))):a.remove()},{type:"GET",error:!1,global:!1}),e.tooltip(XenForo.configureTooltipRtl({predelay:500,delay:0,effect:"RightPreviewTooltip",fadeInSpeed:"normal",fadeOutSpeed:"fast",tip:a,position:"bottom right",offset:[10,15]})),e.data("tooltip").show(0),XenForo._PreviewTooltipCache[r]&&t(XenForo._PreviewTooltipCache[r]).xfInsert("replaceAll",a.find(".PreviewContents"),"show",0)):console.error("Unable to find #PreviewTooltip")}},800))},mouseleave:function(){o?e.data("tooltip")&&e.data("tooltip").hide():a&&clearTimeout(a)},mousedown:function(){a&&clearTimeout(a),e.data("tooltip")&&e.data("tooltip").hide()}})):console.warn("Preview tooltip has no preview: %o",e))},Sidane.ThreadmarkSortTree=function(t){this.__construct(t)},Sidane.ThreadmarkSortTree.prototype={__construct:function(e){this.$tree=e,this.$threadmarkList=e.parent().find(e.data("threadmark-list")),this.buttons={$edit:e.parent().find(".EditSortTree"),$save:e.parent().find(".SaveSortTree")},this.urls={load:e.data("load-url"),sync:e.data("sync-url"),index:e.data("index-url")},this.buttons.$edit.on("click",t.context(this,"eEditButtonClick")),this.buttons.$save.on("click",t.context(this,"eSaveButtonClick")),this.init()},init:function(){this.buttons.$save.hide()},load:function(){XenForo.ajax(this.urls.load,"",t.context(function(t){this.$threadmarkList.remove(),this.$tree.jstree({plugins:["dnd","wholerow"],core:{data:t.tree,check_callback:!0,themes:{icons:!1,dots:!1},animation:0},dnd:{copy:!1,drag_selection:!0,large_drag_target:!0,large_drop_target:!0,touch:"selected",inside_pos:"last"}})},this))},sync:function(){var i={tree:JSON.stringify(this.$tree.jstree(!0).get_json("#",{flat:!0}))};XenForo.ajax(this.urls.sync,i,t.context(function(){console.log("Tree synchronized"),this.$tree.closest(".xenOverlay").length>0?(new XenForo.OverlayLoader(t({href:this.urls.index}),!1,{speed:XenForo.speed.fast}).load(),this.$tree.closest(".xenOverlay").remove()):e.location=this.urls.index},this))},eEditButtonClick:function(t){t.preventDefault(),this.buttons.$edit.hide(),this.buttons.$save.show(),this.load()},eSaveButtonClick:function(t){t.preventDefault(),this.sync()}},Sidane.ThreadmarkPositionFiller=function(t){this.__construct(t)},Sidane.ThreadmarkPositionFiller.prototype={__construct:function(e){this.$form=e,this.positionFillerUrl=e.data("position-filler-url"),this.phrases={threadmark_insert_before_existing:e.data("threadmark-insert-before-existing-phrase"),threadmark_after_this_post:e.data("threadmark-after-this-post-phrase"),threadmark_end_of_index:e.data("threadmark-end-of-index-phrase")},this.$threadmarkCategoryIdInput=e.find(':input[name="threadmark_category_id"]'),this.$positionContainer=e.find(".PositionContainer"),this.threadmarkCategoryId=0,this.previousThreadmark=!1,this.lastThreadmark=!1,this.init(),this.$threadmarkCategoryIdInput.on("change",t.context(this,"eThreadmarkCategoryIdChange"))},init:function(){this.update()},update:function(){this.threadmarkCategoryId=this.$threadmarkCategoryIdInput.val(),XenForo.ajax(this.positionFillerUrl,{category_id:this.threadmarkCategoryId},t.context(function(t){this.previousThreadmark=t.previousThreadmark,this.lastThreadmark=t.lastThreadmark,!this.previousThreadmark&&this.lastThreadmark&&(this.previousThreadmark={position:0,label:this.phrases.threadmark_insert_before_existing,link:!1}),this.updatePositionInputs()},this))},updatePositionInputs:function(){this.updatePositionInput(this.$positionContainer.find(".PreviousThreadmark"),this.previousThreadmark,this.phrases.threadmark_after_this_post),this.updatePositionInput(this.$positionContainer.find(".LastThreadmark"),this.lastThreadmark,this.phrases.threadmark_end_of_index),this.updatePositionInputVisibility()},updatePositionInput:function(e,i,o){i||(i={position:0,label:"",link:!1}),e.find(":input").val(i.position+1);var r=e.find(".text");if(r.text(i.label),i.link){var a=t("<a></a>");a.attr("href",i.link),a.attr("title",o),a.attr("target","_blank"),r.wrapInner(a)}},updatePositionInputVisibility:function(){this.$positionContainer.show(),this.$positionContainer.find(".PreviousThreadmark").show(),this.$positionContainer.find(':input[name="position"]').attr("checked",!1),this.previousThreadmark||this.lastThreadmark?this.previousThreadmark.position===this.lastThreadmark.position&&this.$positionContainer.find(".PreviousThreadmark").hide():this.$positionContainer.hide(),this.$positionContainer.find(':input[name="position"]:visible:first').attr("checked",!0)},eThreadmarkCategoryIdChange:function(){this.update()}},Sidane.ThreadmarkIndex=function(t){if(t.closest(".xenOverlay").length>0){var e=t.find(".tabs li:not(.sortTreeButton) a");e.addClass("OverlayTrigger"),e.data("cacheoverlay",!0),t.xfActivate()}},Sidane.ThreadmarkQuickReply=function(e){e.on("QuickReplyComplete",function(){t("#ctrl_threadmark").val(""),t("#ctrl_threadmark_category_id").val("0")})},Sidane.ThreadmarkCategoryStats=function(t){var i=t.data("location");if(i){var o=e.localStorage;void 0===o&&void 0===(o=e.sessionStorage)&&(o={getItem:function(){},setItem:function(){},removeItem:function(){}});var r=t.find(".threadmarkAuthorList");t.find(".showHideControls").show();var a=t.find(".showHideControls .hide"),n=t.find(".showHideControls .show");t.click(function(){o.getItem(i+"_tm")?(o.removeItem(i+"_tm"),a.show(),n.hide()):(o.setItem(i+"_tm","1"),a.hide(),n.show()),r.slideToggle("fast")}),o.getItem(i+"_tm")?(a.hide(),n.show(),r.hide()):(a.show(),n.hide())}},XenForo.register(".ThreadmarkSortTree","Sidane.ThreadmarkSortTree"),XenForo.register(".ThreadmarkPositionFiller","Sidane.ThreadmarkPositionFiller"),XenForo.register(".ThreadmarkIndex","Sidane.ThreadmarkIndex"),XenForo.register("#QuickReply","Sidane.ThreadmarkQuickReply"),XenForo.register(".threadmarkCategoryStats","Sidane.ThreadmarkCategoryStats"),XenForo.register(".RightPreviewTooltip","Sidane.RightPreviewTooltip")}(jQuery,this,document);